<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Lottery on Blockchain</title>
<!--
Rainbow Theme
http://www.templatemo.com/tm-485-rainbow
-->
    <!-- load stylesheets -->
    <script
        src="http://code.jquery.com/jquery-3.3.1.js"
  integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous"></script>
 

    <script src="http://code.jquery.com/ui/1.12.1/jquery-ui.js"
        integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30="
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400">  <!-- Google web font "Open Sans" -->
    <link rel="stylesheet" href="font-awesome-4.5.0/css/font-awesome.min.css">                <!-- Font Awesome -->
    <link rel="stylesheet" href="css/bootstrap.min.css">                                      <!-- Bootstrap style -->
    <link rel="stylesheet" href="css/templatemo-style.css">                                   <!-- Templatemo style -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">                                   <!-- Templatemo style -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/3.5.1/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/3.5.1/js/tabulator.min.js"></script>

    <script type="text/javascript" charset="utf-8" src="https://unpkg.com/sweetalert2@7.19.1/dist/sweetalert2.all.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill@7.1.0/dist/promise.min.js"></script>

    <script type="text/javascript" charset="utf-8">
        $(document).ready(function() {

            $.ajax({
                url: "http://localhost:1185" + "/query-all-events",
                type: "POST", 
                data: "",
                success: function(responseData) {
                    console.log(responseData);
                },
                error: function() {

                }
            });



            $("#allQueryTableReserved").tabulator({
                layout:"fitColumns",
                tooltips:true,
                addRowPos:"top",
//                history:true,
//                pagination:"local",
//                paginationSize:7,
//               movableColumns:true,
                resizableRows:true,
                initialSort:[
                    {column:"name", dir:"asc"},
                ],
                columns:[ //Define Table Columns
                    {title:"행사 이름", field:"name", width:"10px"},
                    {title:"예정발표일", field:"announceData", align:"center", sorter:"date", width:"10px"},
                    {title:"참가자 수", field:"numOfMembers", align:"center", width:"8px"},
                    {title:"우승자 수", field:"numOfWinners", align:"center", width:"8px"},
                    {title:"참여", field:"subscribe", formatter:"tickCross", align:"center", width:"8px", 
                        cellClick:function(e, cell){
                            Swal({
                                title: '이름을 입력하세요',
                                type: 'question',
                                input: 'text',
                                showCancelButton: true,
                                confirmButtonText: '확인',
                                cancelButtonText: '취소'
                            }).then((result) => {
                                if (result.value) {
                                    var functionName = "subscribe";
                                    var participantName = result.value;
                                    var lotteryName = cell.getRow().getData().name;
                                    // 보내기
                                    var allData = {
                                        "functionName" : functionName,
                                        "participantName" : participantName,
                                        "lotteryName" : lotteryName,
                                    };

                                    $.ajax({
                                        url: "http://localhost:1185" + "/subscribe",
                                        type: "POST", 
                                        data: allData,
                                        success: function(responseData) {
                                            Swal(
                                                '참여 성공',
                                                "\"" + participantName + "\" 님이 " 
                                                + "\"" + lotteryName + "\"" + ' 행사에 등록!'
                                                + "<br/>인증토큰" + responseData,
                                                'success'
                                            )
                                        },
                                        error: function() {
                                            Swal(
                                                '참여!',
                                                '참가자 등록 실패',
                                                'error'
                                            )

                                        }
                                    })
                                    // For more information about handling dismissals please visit
                                    // https://sweetalert2.github.io/#handling-dismissals
                                } else if (result.dismiss === Swal.DismissReason.cancel) {
                                }
                            })
                            // alert("Printing row data for: " + cell.getRow().getData().name);
                            // 기존의 subscribe 함수 호출
                        }
                    },
                    {title:"확인", field:"check", formatter:"tickCross", align:"center", width:"8px",
                        cellClick:function(e, cell){
                            alert("Printing row data for: " + cell.getRow().getData().name)
                            // 기존의 subscribe 함수 호출
                        }
                    },
                    {title:"검증", field:"verify",formatter:"tickCross", align:"center", width:"8px",
                        cellClick:function(e, cell){
                            alert("Printing row data for: " + cell.getRow().getData().name)
                            // 기존의 subscribe 함수 호출
                        }
                    },
                ],
            });

            var initTabledata = [
                {id:1, name:"sslab 친목", announceData:"2018/04/27 12:30", numOfWinners: 3, subscribe:1, check:1, verify:1},
                {id:2, name:"포스텍 세미나", announceData:"2018/05/10 12:30", numOfWinners: 20, subscribe:1, check:1, verify:1},
                {id:3, name:"블록체인 세미나", announceData:"2018/05/12 14:00", numOfWinners: 5, subscribe:1, check:1, verify:1},
            ];
            $("#allQueryTableReserved").tabulator("setData", initTabledata);
        } );
    </script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
          <![endif]-->
</head>

    <body id="top">

        <div class="container-fluid">
            
            <div>
                <div class="row tm-color-row tm-bg-blue-1"></div>
                <div class="row tm-color-row tm-bg-blue-2"></div>
                <div class="row tm-header-row tm-bg-blue-3">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 text-xs-center">
                        
                        <h1 class="tm-text-blue-1 tm-h1">Blockchain on Lottery</h1>

                    </div>
                </div>

                <!-- 2. Navigation -->
                <div class="row tm-bg-blue-1">
                    <div class="tm-navbar-container">
                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                            <nav class="navbar navbar-full">                                
                                
                                <div class="text-xs-center tm-sm-bg-blue tm-navbar-rounded" id="tmNavbar">   
                                    <ul class="nav navbar-nav tm-nav">
                                        <li class="nav-item">
                                            <a href="index.html" class="nav-link">Home</a>
                                        </li>
                                    </ul>
                                </div>
                            </nav>  
                        </div>
                    </div>  
                </div>
            </div>            

            <!-- 1. Pack -->
            <div id="allQueryTableReserved" style="margin-top:20px;"></div>



        
</body>
</html>
